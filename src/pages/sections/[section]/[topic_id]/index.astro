---
import Story from '@components/Story.svelte';
import { mediaURL } from '@constants/media';
import Layout from '@layouts/Layout.astro';

const { section, topic_id } = Astro.params;

const topic_name = Astro.url.searchParams.get('title');

if (!topic_id) {
  Astro.redirect('/404');
}

const storyName = topic_name?.replace(/%20/g, ' ');
const storyImage = storyName?.toLocaleLowerCase().replace(/[^a-z0-9]/g, '');

const meta = {
  title: `${storyName} | CoNexus`,
  image:
    `${mediaURL}/conexus-categories/images/${storyImage}/description/description.avif` ||
    '/favicon.ico',
  url: `${import.meta.env.PUBLIC_FRONTEND}/${section}/${topic_id}?title=${topic_name}`,
  nav: storyName,
  header: storyName,
  arrow: './',
};
---

<Layout story={topic_name} {...meta}>
  <Story {section} {topic_id} {topic_name} client:load />
</Layout>
